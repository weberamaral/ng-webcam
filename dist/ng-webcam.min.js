!function(){"use strict";function n(){function n(n,e){return['<div class="ng-webcam" ng-class="{\'no-overlay\' : vm.counter === 0 || vm.config.countdown === 0}">','<span ng-show="vm.webcamLive === true && vm.config.countdown > 0 && vm.counter > 0" id="counter">{{vm.counter}}</span>','<img ng-show="vm.webcamLive === true" id="ng-webcam-overlay" ng-src="{{vm.config.overlay}}" />','<div id="ng-webcam-container"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e){function o(){l.config=l.config||{},window.localStorage&&window.localStorage.setItem("visited","1"),angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth=320),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight=240),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),angular.isUndefined(l.config.countdown)?l.config.countdown=0:l.counter=l.config.countdown,c(),t()}function i(){l.webcamLive&&Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1,angular.isDefined(s)&&(e.cancel(s),s=void 0),angular.isDefined(d)&&(e.cancel(d),d=void 0),l.counter=0}function t(){angular.isDefined(l.config.shutterUrl)&&(u=new Audio,u.autoplay=!1,navigator.userAgent.match(/Firefox/)?u.src=l.config.shutterUrl.split(".")[0]+".ogg":u.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100,flip_horiz:!0}),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){angular.isDefined(l.onError)&&l.onError({err:n})})}function a(n){u&&u.play(),n===l.config.shots-1&&e.cancel(s),Webcam.snap(function(e){if(m[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var o=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:o})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:m})})}function r(){if(l.config.countdown){if(void 0!==d)return;l.counter=l.config.countdown,d=e(function(){if(l.counter=l.counter-1,0===l.counter){d&&e.cancel(d),a(0);var n=1;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots-1)}},1e3,l.config.countdown)}else{var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}}function f(){Webcam.attach("#ng-webcam-container")}function g(){i()}var u,s,d,l=this,m=[];l.webcamLoaded=!1,l.webcamLive=!1,l.counter=0,l.init=o,l.destroy=i,n.$on("ngWebcam_capture",r),n.$on("ngWebcam_on",f),n.$on("ngWebcam_off",g)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"vm",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsInZtIiwiY29uZmlnIiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImFuZ3VsYXIiLCJpc1VuZGVmaW5lZCIsInZpZXdlcldpZHRoIiwidmlld2VySGVpZ2h0Iiwib3V0cHV0V2lkdGgiLCJvdXRwdXRIZWlnaHQiLCJkZWxheSIsInNob3RzIiwiY291bnRkb3duIiwiY291bnRlciIsImNvbmZpZ3VyZUxpc3RlbmVycyIsImNvbmZpZ3VyZSIsIndlYmNhbUxpdmUiLCJXZWJjYW0iLCJyZXNldCIsIndlYmNhbUxvYWRlZCIsImlzRGVmaW5lZCIsInNuYXBzaG90VGltZXIiLCJjYW5jZWwiLCJ1bmRlZmluZWQiLCJjb3VudGRvd25UaW1lciIsInNodXR0ZXJVcmwiLCJzb3VuZCIsIkF1ZGlvIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJtYXRjaCIsInNyYyIsInNwbGl0Iiwic2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXN0X3dpZHRoIiwiZGVzdF9oZWlnaHQiLCJmb3JjZV9mbGFzaCIsImltYWdlX2Zvcm1hdCIsImpwZWdfcXVhbGl0eSIsImZsaXBfaG9yaXoiLCJmbGFzaE5vdERldGVjdGVkVGV4dCIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImF0dGFjaCIsIm9uIiwiJGFwcGx5Iiwib25Mb2FkIiwib25MaXZlIiwiZXJyIiwib25FcnJvciIsImNhcHR1cmUiLCJpbmRleCIsInBsYXkiLCJzbmFwIiwiZGF0YV91cmkiLCJpbWFnZXMiLCJvbkNhcHR1cmVQcm9ncmVzcyIsInByb2dyZXNzIiwiTWF0aCIsInJvdW5kIiwib25DYXB0dXJlQ29tcGxldGUiLCJvbldlYmNhbUNhcHR1cmUiLCJjb3VudCIsIm9uV2ViY2FtT24iLCJvbldlYmNhbU9mZiIsInRoaXMiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImJpbmRUb0NvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiJGluamVjdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQXNCQSxTQUFBQSxLQWtCQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLE9BQUEsc0dBQ0EseUhBQ0EsaUdBQ0EsdUNBQ0EsVUFBQUMsS0FBQSxJQUdBLFFBQUFDLEdBQUFDLEVBQUFKLEVBQUFDLEVBQUFJLEdBQ0FBLEVBQUFDLE9BQ0FGLEVBQUFHLElBQUEsV0FBQSxXQUNBRixFQUFBRyxZQU1BLFFBQUFDLEdBQUFDLEVBQUFDLEdBNENBLFFBQUFMLEtBQ0FNLEVBQUFDLE9BQUFELEVBQUFDLFdBQ0FDLE9BQUFDLGNBQUFELE9BQUFDLGFBQUFDLFFBQUEsVUFBQSxLQUNBQyxRQUFBQyxZQUFBTixFQUFBQyxPQUFBTSxlQUFBUCxFQUFBQyxPQUFBTSxZQUFBLEtBQ0FGLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFPLGdCQUFBUixFQUFBQyxPQUFBTyxhQUFBLEtBQ0FILFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFRLGVBQUFULEVBQUFDLE9BQUFRLFlBQUEsS0FDQUosUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVMsZ0JBQUFWLEVBQUFDLE9BQUFTLGFBQUEsS0FDQUwsUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVUsU0FBQVgsRUFBQUMsT0FBQVUsTUFBQSxHQUNBTixRQUFBQyxZQUFBTixFQUFBQyxPQUFBVyxTQUFBWixFQUFBQyxPQUFBVyxNQUFBLEdBQ0FQLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFZLFdBQUFiLEVBQUFDLE9BQUFZLFVBQUEsRUFBQWIsRUFBQWMsUUFBQWQsRUFBQUMsT0FBQVksVUFDQUUsSUFDQUMsSUFHQSxRQUFBcEIsS0FDQUksRUFBQWlCLFlBQUFD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QVcsUUF1QkEsUUFBQXVELEtBQ0FqRCxPQUFBNkIsT0FBQSx3QkFHQSxRQUFBcUIsS0FDQXhFLElBbExBLEdBQ0ErQixHQUFBTCxFQUFBRyxFQURBekIsRUFBQXFFLEtBRUFWLElBQ0EzRCxHQUFBb0IsY0FBQSxFQUNBcEIsRUFBQWlCLFlBQUEsRUFDQWpCLEVBQUFjLFFBQUEsRUFDQWQsRUFBQU4sS0FBQUEsRUFDQU0sRUFBQUosUUFBQUEsRUFXQUUsRUFBQUgsSUFBQSxtQkFBQXNFLEdBV0FuRSxFQUFBSCxJQUFBLGNBQUF3RSxHQVdBckUsRUFBQUgsSUFBQSxlQUFBeUUsR0E1RUEsR0FBQUUsSUFDQUMsU0FBQSxJQUNBcEYsU0FBQUEsRUFDQUksS0FBQUEsRUFDQWlGLGtCQUFBLEVBQ0FDLFdBQUE1RSxFQUNBNkUsYUFBQSxLQUNBbEYsT0FDQVMsT0FBQSxJQUNBK0Qsa0JBQUEsSUFDQVgsUUFBQSxJQUNBSCxPQUFBLElBQ0FVLGtCQUFBLElBQ0FULE9BQUEsS0E0TUEsT0F6TEF0RCxHQUFBOEUsU0FBQSxTQUFBLGFBeUxBTCxFQS9PQWpFLFFBQUF1RSxPQUFBLGdCQUFBTixVQUFBLFdBQUFwRixHQUNBQSxFQUFBeUYiLCJmaWxlIjoibmctd2ViY2FtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyLm1vZHVsZSgnbmctd2ViY2FtJywgW10pLmRpcmVjdGl2ZSgnbmdXZWJjYW0nLCBuZ1dlYmNhbSk7XG4gIG5nV2ViY2FtLiRpbmplY3QgPSBbXTtcbiAgLyoqXG4gICAqICBAbmdkb2MgRGlyZWN0aXZlXG4gICAqICBAbmFtZSBuZy13ZWJjYW1cbiAgICogIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiAgRGlyZWN0aXZlIGZvciBjYXB0dXJpbmcgaW1hZ2VzIGZyb20geW91ciBjb21wdXRlcidzIGNhbWVyYSwgYW5kIGRlbGl2ZXJ5IHRoZW4gdG8geW91IGFzIGRhdGEgdXJpXG4gICAqXG4gICAqICBAdXNhZ2VcbiAgICogIGBgYGh0bWxcbiAgICogIDxuZy13ZWJjYW1cbiAgICogICAgY29uZmlnPVwidm0uY29uZmlnXCJcbiAgICogICAgb24tZXJyb3I9XCJ2bS5vbkVycm9yKGVycilcIlxuICAgKiAgICBvbi1sb2FkPVwidm0ub25Mb2FkKClcIlxuICAgKiAgICBvbi1saXZlPVwidm0ub25MaXZlKClcIlxuICAgKiAgICBvbi1jYXB0dXJlLXByb2dyZXNzPVwidm0ub25DYXB0dXJlUHJvZ3Jlc3Moc3JjLCBwcm9ncmVzcylcIlxuICAgKiAgICBvbi1jYXB0dXJlLWNvbXBsZXRlPVwidm0ub25DYXB0dXJlQ29tcGxldGUoc3JjKVwiPlxuICAgKiAgPC9uZy13ZWJjYW0+XG4gICAqICBgYGBcbiAgICovXG4gIGZ1bmN0aW9uIG5nV2ViY2FtKCkge1xuICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlLFxuICAgICAgbGluazogbGluayxcbiAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICBjb250cm9sbGVyOiBuZ1dlYmNhbUNvbnRyb2xsZXIsXG4gICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICBzY29wZToge1xuICAgICAgICBjb25maWc6ICc9JyxcbiAgICAgICAgb25DYXB0dXJlQ29tcGxldGU6ICcmJyxcbiAgICAgICAgb25FcnJvcjogJyYnLFxuICAgICAgICBvbkxvYWQ6ICcmJyxcbiAgICAgICAgb25DYXB0dXJlUHJvZ3Jlc3M6ICcmJyxcbiAgICAgICAgb25MaXZlOiAnJidcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdGVtcGxhdGUoZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgIHJldHVybiBbJzxkaXYgY2xhc3M9XCJuZy13ZWJjYW1cIiBuZy1jbGFzcz1cIntcXCduby1vdmVybGF5XFwnIDogdm0uY291bnRlciA9PT0gMCB8fCB2bS5jb25maWcuY291bnRkb3duID09PSAwfVwiPicsXG4gICAgICAgICc8c3BhbiBuZy1zaG93PVwidm0ud2ViY2FtTGl2ZSA9PT0gdHJ1ZSAmJiB2bS5jb25maWcuY291bnRkb3duID4gMCAmJiB2bS5jb3VudGVyID4gMFwiIGlkPVwiY291bnRlclwiPnt7dm0uY291bnRlcn19PC9zcGFuPicsXG4gICAgICAgICc8aW1nIG5nLXNob3c9XCJ2bS53ZWJjYW1MaXZlID09PSB0cnVlXCIgaWQ9XCJuZy13ZWJjYW0tb3ZlcmxheVwiIG5nLXNyYz1cInt7dm0uY29uZmlnLm92ZXJsYXl9fVwiIC8+JyxcbiAgICAgICAgJzxkaXYgaWQ9XCJuZy13ZWJjYW0tY29udGFpbmVyXCI+PC9kaXY+JyxcbiAgICAgICAgJzwvZGl2PiddLmpvaW4oJycpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XG4gICAgICBjdHJsLmluaXQoKTtcbiAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY3RybC5kZXN0cm95KCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ1dlYmNhbUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRpbnRlcnZhbCddO1xuXG4gICAgZnVuY3Rpb24gbmdXZWJjYW1Db250cm9sbGVyKCRzY29wZSwgJGludGVydmFsKSB7XG4gICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2YXIgc291bmQsIHNuYXBzaG90VGltZXIsIGNvdW50ZG93blRpbWVyO1xuICAgICAgdmFyIGltYWdlcyA9IFtdO1xuICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XG4gICAgICB2bS53ZWJjYW1MaXZlID0gZmFsc2U7XG4gICAgICB2bS5jb3VudGVyID0gMDtcbiAgICAgIHZtLmluaXQgPSBpbml0O1xuICAgICAgdm0uZGVzdHJveSA9IGRlc3Ryb3k7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9jYXB0dXJlXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXG4gICAgICAgKlxuICAgICAgICogIExpc3RlbmVyIGZvciBjYXB0dXJlIHVzZXIgYWN0aW9uXG4gICAgICAgKlxuICAgICAgICogIEB1c2FnZVxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fY2FwdHVyZScpO2BcbiAgICAgICAqL1xuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fY2FwdHVyZScsIG9uV2ViY2FtQ2FwdHVyZSk7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vblxuICAgICAgICogIEBkZXNjcmlwdGlvblxuICAgICAgICpcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9uIHVzZXIgYWN0aW9uXG4gICAgICAgKlxuICAgICAgICogIEB1c2FnZVxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb24nKTtgXG4gICAgICAgKi9cbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29uJywgb25XZWJjYW1Pbik7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vZmZcbiAgICAgICAqICBAZGVzY3JpcHRpb25cbiAgICAgICAqXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhbWVyYSBvZmYgdXNlciBhY3Rpb25cbiAgICAgICAqXG4gICAgICAgKiAgQHVzYWdlXG4gICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9vZmYnKTtgXG4gICAgICAgKi9cbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29mZicsIG9uV2ViY2FtT2ZmKTtcblxuICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgdm0uY29uZmlnID0gdm0uY29uZmlnIHx8IHt9O1xuICAgICAgICBpZih3aW5kb3cubG9jYWxTdG9yYWdlKSB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Zpc2l0ZWQnLCAnMScpO1xuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy52aWV3ZXJXaWR0aCkpIHZtLmNvbmZpZy52aWV3ZXJXaWR0aCA9IDMyMDtcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VySGVpZ2h0KSkgdm0uY29uZmlnLnZpZXdlckhlaWdodCA9IDI0MDtcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcub3V0cHV0V2lkdGgpKSB2bS5jb25maWcub3V0cHV0V2lkdGggPSAzMjA7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLm91dHB1dEhlaWdodCkpIHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQgPSAyNDA7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmRlbGF5KSkgdm0uY29uZmlnLmRlbGF5ID0gMDtcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuc2hvdHMpKSB2bS5jb25maWcuc2hvdHMgPSAxO1xuXHQgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuY291bnRkb3duKSl7IHZtLmNvbmZpZy5jb3VudGRvd24gPSAwOyB9IGVsc2Uge3ZtLmNvdW50ZXIgPSB2bS5jb25maWcuY291bnRkb3duOyB9XG4gICAgICAgIGNvbmZpZ3VyZUxpc3RlbmVycygpO1xuICAgICAgICBjb25maWd1cmUoKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgICAgaWYodm0ud2ViY2FtTGl2ZSkgV2ViY2FtLnJlc2V0KCk7XG4gICAgICAgIHZtLndlYmNhbUxpdmUgPSBmYWxzZTtcbiAgICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHNuYXBzaG90VGltZXIpKSB7XG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbChzbmFwc2hvdFRpbWVyKTtcbiAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKGNvdW50ZG93blRpbWVyKSkge1xuICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoY291bnRkb3duVGltZXIpO1xuICAgICAgICAgIGNvdW50ZG93blRpbWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHZtLmNvdW50ZXIgPSAwO1xuXG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZSgpIHtcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uY29uZmlnLnNodXR0ZXJVcmwpKSB7XG4gICAgICAgICAgc291bmQgPSBuZXcgQXVkaW8oKTtcbiAgICAgICAgICBzb3VuZC5hdXRvcGxheSA9IGZhbHNlO1xuICAgICAgICAgIGlmKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0ZpcmVmb3gvKSkge1xuICAgICAgICAgICAgc291bmQuc3JjID0gdm0uY29uZmlnLnNodXR0ZXJVcmwuc3BsaXQoJy4nKVswXSArICcub2dnJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc291bmQuc3JjID0gdm0uY29uZmlnLnNodXR0ZXJVcmw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFdlYmNhbS5zZXQoe1xuICAgICAgICAgIHdpZHRoOiB2bS5jb25maWcudmlld2VyV2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiB2bS5jb25maWcudmlld2VySGVpZ2h0LFxuICAgICAgICAgIGRlc3Rfd2lkdGg6IHZtLmNvbmZpZy5vdXRwdXRXaWR0aCxcbiAgICAgICAgICBkZXN0X2hlaWdodDogdm0uY29uZmlnLm91dHB1dEhlaWdodCxcbiAgICAgICAgICBmb3JjZV9mbGFzaDogZmFsc2UsXG4gICAgICAgICAgaW1hZ2VfZm9ybWF0OiAnanBlZycsXG4gICAgICAgICAganBlZ19xdWFsaXR5OiAxMDAsXG4gICAgICAgICAgZmxpcF9ob3JpejogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uY29uZmlnLmZsYXNoTm90RGV0ZWN0ZWRUZXh0KSkge1xuICAgICAgICAgIFdlYmNhbS5zZXQoJ2ZsYXNoTm90RGV0ZWN0ZWRUZXh0Jywgdm0uY29uZmlnLmZsYXNoTm90RGV0ZWN0ZWRUZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCkpIHtcbiAgICAgICAgICBXZWJjYW0uc2V0U1dGTG9jYXRpb24odm0uY29uZmlnLmZsYXNoRmFsbGJhY2tVcmwpO1xuICAgICAgICB9XG4gICAgICAgIFdlYmNhbS5hdHRhY2goJyNuZy13ZWJjYW0tY29udGFpbmVyJyk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZUxpc3RlbmVycygpIHtcbiAgICAgICAgV2ViY2FtLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLndlYmNhbUxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxvYWQpKSB7XG4gICAgICAgICAgICAgIHZtLm9uTG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgV2ViY2FtLm9uKCdsaXZlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLndlYmNhbUxpdmUgPSB0cnVlO1xuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0ub25MaXZlKSkge1xuICAgICAgICAgICAgICB2bS5vbkxpdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFdlYmNhbS5vbignZXJyb3InLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkVycm9yKSkge1xuICAgICAgICAgICAgdm0ub25FcnJvcih7ZXJyOmVycn0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNhcHR1cmUoaW5kZXgpIHtcbiAgICAgICAgaWYoc291bmQpIHtcbiAgICAgICAgICBzb3VuZC5wbGF5KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMtMSkpIHtcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHNuYXBzaG90VGltZXIpO1xuICAgICAgICB9XG4gICAgICAgIFdlYmNhbS5zbmFwKGZ1bmN0aW9uKGRhdGFfdXJpKSB7XG4gICAgICAgICAgaW1hZ2VzW2luZGV4XSA9IGRhdGFfdXJpO1xuICAgICAgICAgIGlmKGluZGV4IDwgKHZtLmNvbmZpZy5zaG90cy0xKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVQcm9ncmVzcykpIHtcbiAgICAgICAgICAgIHZhciBwcm9ncmVzcyA9IE1hdGgucm91bmQoKChpbmRleCsxKSAqIDEwMCkgLyB2bS5jb25maWcuc2hvdHMpO1xuICAgICAgICAgICAgdm0ub25DYXB0dXJlUHJvZ3Jlc3Moe3NyYzogZGF0YV91cmkscHJvZ3Jlc3M6IHByb2dyZXNzfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKGluZGV4ID09PSAodm0uY29uZmlnLnNob3RzLTEpICYmIGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uQ2FwdHVyZUNvbXBsZXRlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHZtLm9uQ2FwdHVyZUNvbXBsZXRlKHtzcmM6IGltYWdlc30pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG9uV2ViY2FtQ2FwdHVyZSgpIHtcbiAgICAgICAgaWYoIXZtLmNvbmZpZy5jb3VudGRvd24pIHtcbiAgICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICAgIHNuYXBzaG90VGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgfSwgKHZtLmNvbmZpZy5kZWxheSAqIDEwMDApLCB2bS5jb25maWcuc2hvdHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmKGNvdW50ZG93blRpbWVyICE9PSB1bmRlZmluZWQpIHJldHVybjtcbiAgICAgICAgICB2bS5jb3VudGVyID0gdm0uY29uZmlnLmNvdW50ZG93bjtcbiAgICAgICAgICBjb3VudGRvd25UaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLmNvdW50ZXIgPSB2bS5jb3VudGVyIC0gMTtcbiAgICAgICAgICAgIGlmKHZtLmNvdW50ZXIgPT09IDApIHtcbiAgICAgICAgICAgICAgaWYoY291bnRkb3duVGltZXIpIHtcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGNvdW50ZG93blRpbWVyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy9zbmFwIGZpcnN0XG5cdCAgICAgICAgICBjYXB0dXJlKDApO1xuICAgICAgICAgICAgICB2YXIgY291bnQgPSAxO1xuICAgICAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xuXHQgICAgICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xuICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgfSwgKHZtLmNvbmZpZy5kZWxheSAqIDEwMDApLCB2bS5jb25maWcuc2hvdHMgLSAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCAxMDAwLCB2bS5jb25maWcuY291bnRkb3duKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbU9uKCkge1xuICAgICAgICBXZWJjYW0uYXR0YWNoKCcjbmctd2ViY2FtLWNvbnRhaW5lcicpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvbldlYmNhbU9mZigpIHtcbiAgICAgICAgZGVzdHJveSgpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGlyZWN0aXZlO1xuICB9XG59KSgpOyJdfQ==
